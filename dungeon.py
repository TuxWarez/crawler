import os
import numpy as np
import copy

key_ammount = 0; moves_allowed = 0; map_index = 0
x_coord = 12; y_coord = 11
coords = np.array([[12, 11], [10, 10], [4, 13], [4, 14]])
mode = 0
WALLS = np.array(['═', '║', '╚', '╝', '╔', '╗'])
LEVEL_TITLECARD = np.array(["LVL01: Introduction", "LVL02: Four way", "LVL03: Boxes", "MAP04: Buttons"])

lvl01 = np.array([['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '╔', '═', '╗', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '║', 'E', '║', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '║', 'D', '║', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '╔', '═', '═', '╝', '.', '║', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '║', 'K', '.', '.', '@', '║', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '╚', '═', '═', '═', '═', '╝', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.']])
lvl01_start = copy.deepcopy(lvl01)

lvl02 = np.array([['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '╔', '═', '═', '═', '═', '═', '╗', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '║', 'D', '.', '.', '.', '.', '║', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '║', 'K', '║', '.', '║', 'D', '║', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '║', 'K', '║', '.', '║', '.', '║', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '╔', '═', '═', '═', '╬', '=', '║', '.', '║', '═', '╬', '═', '═', '═', '╗', '.', '.', '.'],
                  ['.', '.', '.', '║', '.', '.', 'K', '║', '█', '║', '.', '║', '█', '║', 'E', 'D', '.', '║', '.', '.', '.'],
                  ['.', '.', '.', '║', '.', '═', '═', '═', '═', '╝', '.', '╚', '═', '═', '═', '═', '.', '║', '.', '.', '.'],
                  ['.', '.', '.', '║', '.', 'K', 'K', 'D', 'D', '.', '@', '.', '.', '.', 'D', 'D', '.', '║', '.', '.', '.'],
                  ['.', '.', '.', '║', '.', '═', '═', '═', '═', '╗', '.', '╔', '═', '═', '═', '═', '.', '║', '.', '.', '.'],
                  ['.', '.', '.', '║', '.', '.', 'K', '║', '█', '║', '.', '║', '█', '║', 'E', 'D', '.', '║', '.', '.', '.'],
                  ['.', '.', '.', '╚', '═', '═', '═', '╬', '═', '║', '.', '║', '═', '╬', '═', '═', '═', '╝', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '║', '.', '║', '.', '║', 'K', '║', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '║', 'D', '║', '.', '║', '.', '║', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '║', '.', '.', '.', '.', '.', '║', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '╚', '═', '═', '═', '═', '═', '╝', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.']])
lvl02_start = copy.deepcopy(lvl02)

lvl03 = np.array([['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '╔', '═', '═', '═', '═', '═', '═', '═', '═', '═', '═', '═', '╗', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '║', '.', '.', '.', '.', '.', '.', '.', '.', 'H', '.', 'E', '║', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '║', '.', '╔', '╗', '.', '╔', '╗', '.', '╔', '═', '═', '═', '╝', '.', '.', '.'],
                  ['.', '.', '.', '.', '╔', '╝', '.', '╚', '╝', '.', '╚', '╝', '.', '║', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '║', '.', 'B', '.', '.', 'B', '.', '.', 'B', '║', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '╚', '╗', '.', '╔', '╗', '.', '╔', '╗', '.', '║', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '╔', '═', '╝', '.', '╚', '╝', '.', '╚', '╝', '.', '║', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '║', '@', '.', '.', '.', '.', '.', '.', '.', '.', '║', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '╚', '═', '═', '═', '═', '═', '═', '═', '═', '═', '╝', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.']])
lvl03_start = copy.deepcopy(lvl03)

lvl04 = np.array([['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '╔', '═', '═', '═', '═', '═', '═', '═', '═', '═', '═', '═', '╗', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '║', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '║', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '║', '.', '.', '.', '.', '.', '.', '.', '.', 'H', '.', 'E', '║', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '║', '.', '╔', '═', '.', '═', '╗', '.', '╔', '═', '═', '═', '╝', '.', '.', '.'],
                  ['.', '.', '.', '.', '╔', '╝', '.', '╚', '.', 'O', '.', '╝', '.', '║', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '║', '.', 'B', '.', 'O', 'o', 'O', '.', 'B', '║', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '╚', '╗', '.', '╔', '.', 'O', '.', '╗', '.', '║', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '╔', '═', '╝', '.', '╚', '═', '.', '═', '╝', '.', '║', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '║', '@', '.', '.', '.', '.', '.', '.', '.', '.', '║', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '╚', '═', '═', '═', '═', '═', '═', '═', '═', '═', '╝', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'],
                  ['.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.']])
lvl04_start = copy.deepcopy(lvl04)


LEVELS = np.array([lvl01, lvl02, lvl03, lvl04])
LEVELS_START = np.array([lvl01_start, lvl02_start, lvl03_start, lvl04_start])

def print_level(level):
    global mode
    os.system("clear")
    if mode == 1:
        for i in range(3, 18):
            for j in range(3, 18):
                print(LEVELS[map_index][i, j], end=" ")
            print()
    elif mode == 2:
        for i in range(y_coord - 2, y_coord + 3):
            for j in range(x_coord - 2, x_coord + 3):
                print(LEVELS[map_index][i, j], end=" ")
            print()
    else:
        for i in range(y_coord - 4, y_coord + 5):
            for j in range(x_coord - 4, x_coord + 5):
                print(LEVELS[map_index][i, j], end=" ")
            print()
    print(LEVEL_TITLECARD[map_index])
    print(f"KEYS={key_ammount} MOVES={moves_allowed}")

def character_movement(x_dir, y_dir):
    global key_ammount, map_index, y_coord, x_coord, moves_allowed
    moves_allowed += 1
    if LEVELS[map_index][y_coord + y_dir, x_coord + x_dir] in WALLS:
        input("You can't go through walls, try again: ")
        moves_allowed -= 1
        return
    elif LEVELS[map_index][y_coord + y_dir, x_coord + x_dir] == "D":
        if key_ammount == 0:
            input("You dont have the key ")
            return
        key_ammount -= 1
    elif LEVELS[map_index][y_coord + y_dir, x_coord + x_dir] == "B":
        while True:
            if LEVELS[map_index][y_coord + y_dir + y_dir, x_coord + x_dir + x_dir] in WALLS:
                input("You can't go through walls, try again: ")
                moves_allowed -= 1
                return
            elif LEVELS[map_index][y_coord + y_dir + y_dir, x_coord + x_dir + x_dir] == "B":
                input("You can't push more than a single box at a time, try again: ")
                moves_allowed -= 1
                return
            elif LEVELS[map_index][y_coord + y_dir + y_dir, x_coord + x_dir + x_dir] == "*":
                LEVELS[map_index][y_coord + y_dir + y_dir, x_coord + x_dir + x_dir] = "*"
                break
            elif LEVELS[map_index][y_coord + y_dir + y_dir, x_coord + x_dir + x_dir] == "H":
                LEVELS[map_index][y_coord + y_dir + y_dir, x_coord + x_dir + x_dir] = "."
                break
            LEVELS[map_index][y_coord + y_dir + y_dir, x_coord + x_dir + x_dir] = "B"
            break
    elif LEVELS[map_index][y_coord + y_dir, x_coord + x_dir] == "K":
        key_ammount += 1
    elif LEVELS[map_index][y_coord + y_dir, x_coord + x_dir] == "H":
        input("You fell down a hole...")
        moves_allowed = 0
        key_ammount = 0
        x_coord, y_coord = coords[map_index, 0], coords[map_index, 1]
        LEVELS[map_index] = copy.deepcopy(LEVELS_START[map_index])
        return
    elif LEVELS[map_index][y_coord + y_dir, x_coord + x_dir] == "E":
        map_index += 1
        x_coord, y_coord = coords[map_index, 0], coords[map_index, 1]
        moves_allowed = 0
        key_ammount = 0
        return
    x_coord += x_dir; y_coord += y_dir
    LEVELS[map_index][y_coord, x_coord] = "@"
    LEVELS[map_index][y_coord - y_dir, x_coord - x_dir] = "."

def character_input():
    global key_ammount, map_index, y_coord, x_coord, moves_allowed
    action = input("Input an action: ")
    if action == "restart":
        moves_allowed = 0
        key_ammount = 0
        x_coord, y_coord = coords[map_index, 0], coords[map_index, 1]
        LEVELS[map_index] = copy.deepcopy(LEVELS_START[map_index])
    elif action == "up" or action == "u":
        character_movement(0, -1)
    elif action == "down" or action == "d":
        character_movement(0, 1)
    elif action == "left" or action == "l":
        character_movement(-1, 0)
    elif action == "right" or action == "r":
        character_movement(1, 0)
    elif action == "next":
        map_index += 1
        key_ammount = 0
        x_coord, y_coord = coords[map_index, 0], coords[map_index, 1]
        moves_allowed = 0

os.system("clear")
print("1. Easy")
print("2. Medium")
print("3. Hard")
dif = input("Select difficulty: ")

if dif == "1":
    mode = 1
elif dif == "3":
    mode = 2

while True:
    print_level(LEVELS[map_index])
    character_input()
